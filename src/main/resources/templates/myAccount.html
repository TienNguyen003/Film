<!DOCTYPE html>
<html lang="zxx">

<head>
	<meta charset="UTF-8">
	<meta name="description" content="Trang Vietsub và cập nhật các bộ Hoạt Hình mới nhất">
	<meta name="keywords" content="Anime, unica, creative, html">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Cập Nhật Thông Tin Tài Khoản</title>
	<link rel="shortcut icon" href="img/bg.jfif" type="image/x-icon">

	<!-- Google Font -->
	<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700;800;900&display=swap"
		rel="stylesheet">

	<!-- Css Styles -->
	<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
	<link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
	<link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
	<link rel="stylesheet" href="css/plyr.css" type="text/css">
	<link rel="stylesheet" href="css/nice-select.css" type="text/css">
	<link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
	<link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
	<link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body>
	<!-- Page Preloder -->
	<div id="preloder">
		<div class="loader"></div>
	</div>

	<!-- Header Section Begin -->
	<div th:replace="header :: content"></div>
	<!-- Header End -->

	<div class="myAccount spad">
		<div class="container">
			<div class="row" th:with="userDetails=${#authentication.getPrincipal()}">
				<div class="col-lg-4 infoAccount" th:object="${user}">
					<img th:src="${userDetails.getImg() != null ? userDetails.getImg() : 'https://i.pinimg.com/564x/a2/2d/1d/a22d1d8a789a904187dba0f5240a5907.jpg'}"
						class="img__myAccount">
					<label for="avatarInput" style="cursor: pointer;"><span>Thay đổi avatar</span></label>
					<input type="file" id="avatarInput" style="display: none;" onchange="uploadImage()" />
					<span class="name__myAccount"
						th:text="${userDetails.getFullName() != null ? userDetails.getFullName() : userDetails.username}"></span>
					<div class="mycred-users-badges">
						<div class="the-badge" th:each="list : ${listImgBadges}"><img th:src="${list}"
								class="mycred-badge-image badge-level3" width="100" height="100"></div>
					</div>
					<span class="level__myAccount">Hoàng Thiên Cảnh</span>
					<blockquote style="width: 100%">
						<p class="text-muted maxim" th:text="${userDetails.getMaxim}"></p>
					</blockquote>
					<div class="button-group">
						<a href="/my-account/diem-danh" class="btn btn-danger"><i class="fa fa-calendar"></i> Điểm
							Danh</a>
						<a href="/tu-bao-cac" class="btn btn-danger"><i class="fa fa-calendar"></i> Tụ Bảo Các</a>
						<a href="/bang-xep-hang-tu-vi" class="btn btn-danger"><i class="fa fa-star"></i> BXH Tu Vi</a>
						<a href="/phong-chat-version-2-0" class="btn btn-danger"><i class="fa fa-comments"></i>Phòng
							Chat</a>
						<a href="/gop-y" class="btn btn-danger"><i class="fa fa-comment"></i> Góp Ý</a>
						<a href="/my-account/edit-pass" class="btn btn-danger"><i class="fa fa-lock"></i>Thay Đổi
							Mật Khẩu</a>
					</div>
				</div>
				<div class="col-lg-8 edit-account">
					<div class="card">
						<form method="post" action="/my-account/update-maxim">
							<div class="form-group">
								<label for="new_display_name">Biệt danh:</label>
								<input type="text" class="form-control" th:value="${userDetails.getFullName}" readonly>
								<a href="/my-account/cap-nhat-biet-danh" class="btn btn-info">Đổi Biệt Danh</a>
							</div>
							<div class="form-group">
								<label for="tu_vi">Tu vi: </label>
								<input type="text" class="form-control" th:value="${userDetails.getPoint}" readonly>
							</div>
							<div class="form-group">
								<label for="user_bio">Châm ngôn:</label>
								<textarea maxlength="300" name="user_bio" class="form-control" rows="3"
									th:text="${userDetails.getMaxim}"></textarea>
							</div>
							<div class="form-group">
								<label for="user_dob">Ngày sinh:</label>
								<input type="text" class="form-control" th:value="${userDetails.getBirthday}" readonly>
							</div>
							<div class="form-group">
								<label for="user_name">Tên tài khoản:</label>
								<input type="text" class="form-control" th:value="${userDetails.username}" readonly>
							</div>
							<div class="form-group">
								<label for="user_email">Email:</label>
								<input type="text" class="form-control" th:value="${userDetails.email}" readonly>
								<a href="/thay-doi-email" class="btn btn-info">Đổi Email</a>
							</div>
							<div class="form-group">
								<label for="registration_date">Ngày đăng ký:</label>
								<input type="text" class="form-control" th:value="${userDetails.getCreateAt}" readonly>
							</div>
							<button type="submit" class="btn btn-success">Cập nhật</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Footer Section Begin -->
	<div th:replace="footer :: content"></div>
	<!-- Footer Section End -->

	<!-- Search model Begin -->
	<div th:replace="search :: content"></div>
	<!-- Search model end -->

	<!-- Js Plugins -->
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/player.js"></script>
	<script src="js/jquery.nice-select.min.js"></script>
	<script src="js/mixitup.min.js"></script>
	<script src="js/jquery.slicknav.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/main.js"></script>

	<!-- cloudinary -->
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.28.0/js/vendor/jquery.ui.widget.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.28.0/js/jquery.iframe-transport.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.28.0/js/jquery.fileupload.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-core/2.9.0/cloudinary-core-shrinkwrap.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-jquery-file-upload/1.0.23/cloudinary-jquery-file-upload.min.js"></script>
</body>
<script th:inline="javascript">
	var notification = /*[[${notification}]]*/ null;
	if (notification) {
		alert(notification);
	}

	// Thay thế bằng cloud name của bạn
	var cloudName = 'dwn20guz0';

	// Hàm tải lên ảnh lên Cloudinary
	function uploadImage() {
		var fileInput = document.getElementById('avatarInput');
		var file = fileInput.files[0];

		if (file) {
			// Khởi tạo FormData để gửi dữ liệu tệp lên
			var formData = new FormData();
			formData.append('file', file);
			formData.append('upload_preset', 'cgklkmau');

			// Gửi yêu cầu POST để tải lên ảnh lên Cloudinary
			fetch('https://api.cloudinary.com/v1_1/' + cloudName + '/image/upload', {
				method: 'POST',
				body: formData
			})
				.then(response => response.json())
				.then(data => {
					// Lấy URL của ảnh đã tải lên từ kết quả trả về
					var imageUrl = data.url;

					// Hiển thị URL của ảnh đã tải lên
					updateAvatar(parseInt(document.querySelector(".idUserLogin").innerHTML), imageUrl);
					document.querySelector(".img__myAccount").src = imageUrl;
					document.querySelector(".imgUser").src = imageUrl;
				})
				.catch(error => {
					console.error('Error:', error);
				});
		} else {
			alert('Please select an image file.');
		}
	}

	function updateAvatar(id, img) {
		$.ajax({
			type: "POST",
			url: "/my-account/upload-image",
			data: {
				id: id,
				img: img
			},
			dataType: 'html',
			timeout: 100000,
			success: function (data) {
				console.log("Tiến đẹp zai")
			},
			error: function (e) {
				console.log("ERROR: ", e);
			}
		})
	}
</script>

</html>